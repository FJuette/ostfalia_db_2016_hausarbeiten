#4 Recovery 

Das Wiederherstellen eines korrekten Datenbankzustandes nach einem Fehlerfall ist Aufgabe der Recoverykomponente eines Datenbankverwaltungssystems (vgl. Meier / Kaufmann, 2016, S. 146). Aufgrund der Forderung nach Dauerhaftigkeit sind Änderungen erfolgreich beendeter Transaktionen gegen jede Art von Fehlern zu schützen und der Datenverlust zu verhindern. Weiterhin verlangt Atomarität gemäß des „Alles-oder-Nichts"-Prinzips, dass Transaktionen, die durch einen Fehler nicht beendet werden konnten, zurückgesetzt werden. 
Für eine Fehlerbehandlung ist es einerseits wichtig, die Fehlerart zu kennen und andererseits nicht erst beim Eintreten von Fehlern in Handlung zu treten. Viel eher sind schon im normalen Betrieb des Datenbankvewaltungssystems Vorkehrungen zu treffen, die eine Fehlerbehandlung überhaupt erst möglich machen. Benötigt werden daher u.a. eine Log-Datei, in der insbesondere alle zuletzt ausgeführten Änderungen der Datenbank protokolliert werden, sowie Sicherungspunkte, die Positionen für den Wiederanlauf kennzeichnen (vgl. Härder / Rahm, 1999, S. 456; Kemper / Eickler, 2009, S. 302). Weiterhin wird für den schlimmsten Fall ein Log-Archiv, dass ältere Log-Sätze enthält, und eine Archivkopie, d.h. eine Sicherheitskopie der Datenbank, die in regelmäßigen Zeitabstanden gemacht werden sollte, benötigt (vgl. Härder / Rahm, 1999, S. 456). Grundlegend können Transaktionsfehler, Systemfehler und Geräte- bzw. Externspeicherfehler unterschieden werden, die von der Recoverykomponente behandelt werden (vgl. Härder / Rahm, 1999, S. 455).

Ein *Transaktionsfehler* ist der am häufigsten auftretende Fehler, welcher dazu führt, dass eine Transaktion nicht beendet werden kann. Typische Fehlerquellen sind z.B. ein Transaktionsabbruch aufgrund einer ROLLBACK-Anweisung oder ein systemgesteuerter Abbruch der Transaktion. Gelöst werden Transaktionsfehler mittels einer Undo-Recovery, indem alle vorgenommenen Datenänderungen der betroffenen Transaktion zurückgesetzt werden. (vgl. Härder / Rahm, 1999, S. 456 f.; Kemper / Eickler, 2009, S. 287)

Ein *Systemfehler* kann u.a. durch einen Stromausfall oder einen Hardwareausfall verursacht werden. Befinden sich zum Zeitpunkt des Fehlers Datenänderungen im Hauptspeicher, aber noch nicht im Externspeicher, so sind diese verloren bzw. kann sich auf ihre Korrektheit nicht mehr bedenkenlos verlassen werden. Eine Fehlerbehebung erfolgt hier mit der auf der Externspeicher vorliegenden materialisierten Datenbank sowie der temporären Log-Datei. Es wird hier also angenommen, dass die materialisierte Datenbank zwar nicht zerstört ist, sich aber in einem inkonsistenten Zustand befindet. Mittels einer Undo-Recovery werden alle Änderungen durch nicht erfolgreich beendete Transaktionen, die aber schon in die materialisierte Datenbank gekommenen sind, zurückgesetzt. Gleichzeitig sind alle Änderungen für erfolgreich abgeschlossene Transaktionen durch eine Redo-Recovery zu wiederholen, sofern diese noch nicht in der materialisierten Datenbank festgeschrieben sind. (vgl. Härder / Rahm, 1999, S. 457)
 
Ein *Externspeicherfehler* tritt beispielsweise auf, wenn eine der Platten des externen Speichers in Folge eines Head Crash, d.h. dem Aufsetzen des Lese/-Schreibkopfs auf die Platte, beschädigt wird oder eine Platte durch äußere Einflüsse (wie einem Feuer) zerstört wird. Es erfolgt eine Redo-Recovery zur Rekonstruktion verlorengegangener Daten, um die Datenbasis wieder in den jüngsten transaktionskonsistenten Zustand zu bringen. Hierzu wird die letzte vorhandene Archivkopie eingespielt und alle Änderungen erfolgreicher Transaktionen, die seit der Erstellung der Kopie durchgeführt wurden, mit Hilfe der Archiv-Log ergänzt. (vgl. Härder / Rahm, 1999, S. 458; Kemper / Eickler, 2009, S. 289)
